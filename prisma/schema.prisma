generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Recruitment {
  id         Int      @id @default(autoincrement())
  title      String
  templateId Int
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  template   Template @relation(fields: [templateId], references: [id],onDelete: Cascade)
  resumes    Resume[]
}

model Template {
  id           Int             @id @default(autoincrement())
  name         String
  description  String?
  createdAt    DateTime        @default(now())
  updatedAt  DateTime @updatedAt
  recruitments Recruitment[]
  sections     Section[]
}
model Section {
  id          Int      @id @default(autoincrement())
  templateId  Int
  template    Template @relation(fields: [templateId], references: [id],onDelete: Cascade)
  label        String
  key        String
  description String?
  order    Int
  size    Int
  createdAt    DateTime        @default(now())
  updatedAt  DateTime @updatedAt
  sectionFields SectionField[]
}

model Field {
  id          Int      @id @default(autoincrement())
  label        String
  key        String
  description String?
  createdAt    DateTime        @default(now())
  updatedAt  DateTime @updatedAt
  fieldItems      FieldItem[]
  sectionFields SectionField[]
  resumeItems ResumeItem[]
}

model FieldItem {
  id          Int             @id @default(autoincrement())
  label        String
  key        String
  content     Json?
  description String?
  createdAt    DateTime        @default(now())
  updatedAt  DateTime @updatedAt
  order    Int
  fieldId     Int
  field       Field @relation(fields: [fieldId], references: [id],onDelete: Cascade)
}

model SectionField {
  id          Int      @id @default(autoincrement())
  section  Section @relation(fields: [sectionId], references: [id],onDelete: Cascade)
  sectionId Int
  field       Field    @relation(fields: [fieldId], references: [id],onDelete: Cascade)
  fieldId     Int
  order    Int
  isRequired  Boolean  @default(false)
  createdAt    DateTime        @default(now())
  updatedAt  DateTime @updatedAt

  @@unique([sectionId, fieldId])
  @@index([sectionId, fieldId])
}

model Resume {
  id            Int             @id @default(autoincrement())
  name          String
  title         String
  summary       String
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  status        ResumeStatus    @default(DRAFT)
  items         ResumeItem[]
  recruitmentId Int
  recruitment   Recruitment     @relation(fields: [recruitmentId], references: [id],onDelete: Cascade)

  @@index([recruitmentId])
}

model ResumeItem {
  id          Int           @id @default(autoincrement())
  resumeId    Int
  title       String
  content     Json
  description String
  order       Int
  resume      Resume        @relation(fields: [resumeId], references: [id],onDelete: Cascade)
  field       Field?         @relation(fields: [fieldId], references: [id],onDelete: SetNull)
  fieldId     Int?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  @@index([resumeId])
}

enum ResumeStatus {
  DRAFT
  SUBMITTED
  REVIEWING
  APPROVED
  REJECTED
}

